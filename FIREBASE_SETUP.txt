# Firebase Setup for SoundPay Feedback Feature

## Prerequisites
1. Create a Firebase project at https://console.firebase.google.com
2. Add an Android app to your Firebase project
3. Download the `google-services.json` file
4. Replace the placeholder `google-services.json` in `/app/` directory with your actual file

## Firestore Setup

### Enable Firestore
1. Go to Firebase Console > Firestore Database
2. Click "Create Database"
3. Start in **production mode** (we'll set custom rules)
4. Choose a Cloud Firestore location (closest to your users)

### Firestore Security Rules

Navigate to **Firestore Database > Rules** and paste the following:

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Feedback collection - write-only for users
    match /feedback/{feedbackId} {
      // Allow anyone to write feedback
      allow create: if true;

      // Prevent read/update/delete from clients
      allow read, update, delete: if false;
    }

    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

### Rules Explanation

- ✅ **Write-only access**: Users can submit feedback but cannot read others' feedback
- ✅ **No authentication required**: Keeps the app simple and privacy-focused
- ✅ **Create only**: Users can only create new feedback, not update or delete
- ✅ **Secure by default**: All other collections are denied

## Testing

### Test in Firebase Console
1. Go to Firestore Database > Data
2. After submitting feedback from the app, you should see a new document in the `feedback` collection
3. Each document contains:
   - `message`: User feedback text
   - `timestamp`: Unix timestamp (milliseconds)
   - `appVersion`: App version name
   - `versionCode`: App version code
   - `deviceModel`: Device manufacturer and model
   - `androidVersion`: Android SDK version
   - `language`: App language (en/hi)

### Viewing Feedback
Feedback can only be viewed from the Firebase Console (not from the app). This ensures user privacy and prevents abuse.

## Production Considerations

### Optional Enhancements
1. **Enable quotas** to prevent spam (Firebase Console > Firestore > Usage)
2. **Set up indexes** if you plan to query feedback by timestamp
3. **Add Cloud Functions** to process/moderate feedback automatically
4. **Set up email notifications** when new feedback arrives

### Cost Management
- Firestore has a generous free tier
- Expected cost for typical usage: **$0/month** (free tier covers ~50K writes/day)
- Monitor usage in Firebase Console > Usage and billing

## Troubleshooting

### "Default FirebaseApp is not initialized"
- Ensure `google-services.json` is in the correct location (`/app/`)
- Rebuild the project: `./gradlew clean build`

### "PERMISSION_DENIED: Missing or insufficient permissions"
- Check that Firestore rules are correctly set
- Verify rules in Firebase Console > Firestore > Rules

### Feedback not appearing in Firestore
- Check internet connection
- Enable logging in `FeedbackRepository` to see error messages
- Check Android Logcat for Firebase errors

## Support
For issues or questions, refer to:
- [Firebase Firestore Documentation](https://firebase.google.com/docs/firestore)
- [Firestore Security Rules Guide](https://firebase.google.com/docs/firestore/security/get-started)

